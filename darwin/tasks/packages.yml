---
# !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!  TODO: ADD ACTUAL BREW INSTALLATION STEPS  (https://docs.ansible.com/ansible/latest/collections/community/general/homebrew_module.html)  !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
#- community.general.homebrew:
#    name: foo
#    state: latest
#    update_homebrew: true


- name: Install shared packages
  ansible.builtin.include_tasks: '{{ included_task }}'
  loop:
    - ../../linux/roles/common/tasks/package-SHARED.yml
    - ../../linux/roles/workstation/dev_workstation/tasks/package-SHARED.yml
  loop_control:
    loop_var: included_task


- name: Joplin
  block:
    - name: Install
      ansible.builtin.debug:
        msg: "!!!!!!!!!!!!!!!!                            TODO"
    - name: Config
      block:
        - name: Create dir
          ansible.builtin.file:
            path: '/Users/{{ user_name }}/.config/joplin-desktop'
            state: directory
            owner: '{{ user_name }}'
            group: '{{user_group_name}}'
            mode: 0755
        - name: Copy config
          ansible.builtin.template:
            src: apps/joplin.css.j2
            dest: '/Users/{{ user_name }}/.config/joplin-desktop/basenotestyle.css'
            mode: 0755
      become: false


- name: Install iTerm
  block:
    - name: Install
      ansible.builtin.debug:
        msg: "TODO"
    - name: Config
      block:
        - name: Create dir
          ansible.builtin.file:
            path: '/Users/{{ user_name }}/.config/iterm2'
            state: directory
            owner: '{{ user_name }}'
            group: '{{ user_group_name }}'
            mode: 0755
        - name: Copy config
          ansible.builtin.copy:
            src: apps/com.googlecode.iterm2.plist
            dest: '/Users/{{ user_name }}/.config/iterm2/com.googlecode.iterm2.plist'
            mode: 0755
        - name: Set config
          community.general.osx_defaults:
            domain: com.googlecode.iterm2
            key: '{{ item.key }}'
            type: '{{ item.type }}'
            value: '{{ item.value }}'
            state: present
          with_items:
            - { key: 'PrefsCustomFolder', value: '/Users/{{ user_name }}/.config/iterm2/', type: 'string' }
            - { key: 'LoadPrefsFromCustomFolder', value: 'true', type: 'bool' }
      become: false


- name: Install hblock
  block:
    - name: Install
      ansible.builtin.debug:
        msg: "!!!!!!!!!!!!!!!!                            TODO"
    - name: Config
      block:
        - name: Create dir
          ansible.builtin.file:
            path: '/etc/hblock.d'
            state: directory
            owner: 'root'
            group: 'wheel'
            mode: 0755
        - name: Copy config
          ansible.builtin.template:
            src: 'config/hblock/{{ config_file }}.j2'
            dest: '/etc/hblock.d/{{ config_file }}'
            owner: 'root'
            group: 'wheel'
            mode: 0755
          with_items:
            - 'header'
            - 'blacklist.list'
            - 'whitelist.list'
          loop_control:
            loop_var: config_file
        - name: Setup cron job
          ansible.builtin.debug:
            msg: "!!!!!!!!!!!!!!!!                            TODO     (  `sudo crontab -l -u root | awk '!/hblock/' | { cat; echo \"${CRON_TIME}  ${HBLOCK_COMMAND}\"; } | sudo crontab -u root -`  )"
      become: true
