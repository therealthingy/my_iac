---
- name: Setup GNOME
  block:
    - name: Install dconf edtior
      ansible.builtin.apt:
        name: dconf-editor
        state: present
      become: true

    - name: "[Ubuntu] Install GNOME extension manager"
      ansible.builtin.apt:
        name: gnome-shell-extension-manager
        state: present
      when: ansible_facts.distribution == 'Ubuntu'
      become: true

    # NOTE: List extensions: `gnome-extensions list --enabled`
    - name: Install GNOME extensions
      block:
        - name: Install dependencies for GNOME extensions
          ansible.builtin.apt:
            name:
              - gir1.2-gtop-2.0 # Top Hat  (like iStats menu 4 mac)
            state: present
          become: true

        - name: "'Determine' which extensions shall be installed"
          block:
            - name: Set config as vars
              ansible.builtin.set_fact:
                gnome_extensions: # (ids are derived from URL, e.g., https://extensions.gnome.org/extension/307/dash-to-dock/)
                  - id: 2087 # Desktop Icons NG (DING)
                    enable: true # TODO: Currently not working ??!!
                  - id: 3193 # Blur my Shell
                    enable: true
                  - id: 5219 # Top Hat  (like iStats menu 4 mac)
                    enable: true
                  - id: 2 # Move Clock  (Move clock to left of status menu button)
                    enable: true
                  - id: 4839 # Clipboard history
                    enable: true
                  - id: 2236 # Night Theme Switcher     (TODO: ALLEGEDLY NOT WORKING ON UBUNTU, BUT WORKS IN PRAXIS) ??
                    enable: true
                  #- id: 3438                      # Jiggle  (highlights the cursor position when the mouse is moved rapidly like on mac)   $$$$$$$$$$$$$$$$$$$  TOOD: ADD BACK ONCE SUPPORTED (https://github.com/jeffchannell/jiggle/pull/68)  $$$$$$$$$$$$$$$$$$$
                  #  enable: true
                  # TODO (for non-vms): caffeine, cpufreq, wireguard-indicator

            - name: Debian - Set distro specific stuff
              ansible.builtin.set_fact:
                # Dash to Dock
                gnome_extensions: "{{ gnome_extensions + [ { 'id': 307, 'enable': true } ]  }}"
              when: ansible_facts.distribution == 'Debian'

        - name: "Run 'petermosmans.customize-gnome' role"
          ansible.builtin.include_role:
            name: petermosmans.customize-gnome

    # HOW2: gesettings tool  (e.g., `gsettings get org.gnome.desktop.input-sources sources`); example: https://gist.github.com/carlwgeorge/c560a532b6929f49d9c0df52f75a68ae
    - name: GNOME
      block:
        - name: Set config
          block:
            - name: "[Ubuntu]"
              ansible.builtin.set_fact:
                gnome_button_layout: "close,minimize,maximize:"
              when: ansible_facts.distribution == 'Ubuntu'
            - name: "[Debian]"
              ansible.builtin.set_fact:
                gnome_button_layout: "close:"
              when: ansible_facts.distribution == 'Debian'

        - name: GNOME - Set settings
          community.general.dconf:
            key: "{{ gnome_setting.key }}"
            value: "{{ gnome_setting.value }}"
            state: "{{ gnome_setting.state }}"
          with_items:
            # !!  BE AWARE: Schema for gtk (used by `gsettings`): `org.gtk.Settings.FileChooser` v.s. Path (used by dconf editor and Ansible module): `org.gtk.settings.file-chooser`  !!
            # --  General settings  --
            - key: "/org/gnome/desktop/input-sources/sources"
              value: "[('xkb', '{{ keyboard.layout }}')]"
              state: present

            # --  General Behavior  --
            - key: "/org/gnome/desktop/privacy/show-full-name-in-top-bar"
              value: "true"
              state: present
            - key: "/org/gnome/desktop/privacy/remember-recent-files"
              value: "false"
              state: present
            - key: "/org/gnome/desktop/privacy/remove-old-temp-files"
              value: "true"
              state: present
            - key: "/org/gnome/desktop/sound/event-sounds"
              value: "false"
              state: present
            - key: "/org/gnome/desktop/wm/preferences/audible-bell" # TODO: Use `visual-bell` bell instead (currently not suitable (flashes entire screen))
              value: "false"
              state: present
            #            - key: '/org/gnome/desktop/interface/gtk-enable-primary-paste'         # TODO:  Disable "Middle-click paste"  (doesn't work 4 Ubuntu 22.04 LTS)
            #              value: 'false'
            #              state: present
            - key: "/org/gnome/desktop/notifications/show-banners" # 'Do not disturb' in Ubuntu's Settings app
              value: "false"
              state: present
            - key: "/org/gnome/gnome-session/logout-prompt"
              value: "false"
              state: present
            # -  Privacy  -
            - key: "/org/gnome/desktop/privacy/report-technical-problems"
              value: "false"
              state: present
            - key: "/org/gnome/desktop/privacy/send-software-usage-stats"
              value: "false"
              state: present
            # -  Security  -
            - key: "/org/gnome/desktop/media-handling/automount-open"
              value: "false"
              state: present

            # --  General UI  --
            - key: "/org/gnome/desktop/wm/preferences/button-layout"
              value: "'{{ gnome_button_layout }}'"
              state: present
            - key: "/org/gnome/desktop/interface/clock-format"
              value: "'12h'"
              state: present
            - key: "/org/gtk/settings/file-chooser/clock-format"
              value: "'12h'"
              state: present
            - key: "/org/gnome/shell/favorite-apps" # NOTE: Desktop entries for application (.desktop files) reside in '/usr/share/applications/' or '/usr/local/share/applications/'
              value: "[{{ dock_fav_apps | join(', ') }}]"
              state: present
            # --  Extensions  --
            # -  Dock  -
            - key: "/org/gnome/shell/extensions/dash-to-dock/extend-height"
              value: "false"
              state: present
            - key: "/org/gnome/shell/extensions/dash-to-dock/dock-position"
              value: "'LEFT'"
              state: present
            - key: "/org/gnome/shell/extensions/dash-to-dock/dash-max-icon-size"
              value: "25"
              state: present
            - key: "/org/gnome/shell/extensions/dash-to-dock/dock-fixed"
              value: "true"
              state: present
            - key: "/org/gnome/shell/extensions/dash-to-dock/click-action"
              value: "'minimize'"
              state: present
            # -  Desktop  -
            - key: "/org/gnome/shell/extensions/ding/show-home"
              value: "false"
              state: present
            - key: "/org/gnome/shell/extensions/ding/show-trash"
              value: "false"
              state: present
            - key: "/org/gnome/shell/extensions/ding/icon-size"
              value: "'small'"
              state: present
            - key: "/org/gnome/shell/extensions/ding/show-link-emblem"
              value: "true"
              state: present
            - key: "/org/gnome/shell/extensions/ding/start-corner"
              value: "'top-left'"
              state: present
            # - gnome-clipboard-history -
            - key: "/org/gnome/shell/extensions/clipboard-history/confirm-clear"
              value: "false"
              state: present

            # --  Apps  --
            # -  Nautilus  --
            - key: "/org/gnome/nautilus/preferences/show-delete-permanently"
              value: "true"
              state: present
            #- key: '/org/gnome/nautilus/preferences/show-hidden-files'
            #  value: 'true'
            #  state: present
            - key: "/org/gnome/nautilus/preferences/default-sort-order"
              value: "'type'" # Possible values: size, type, mtime, atime, starred
              state: present
            - key: "/org/gnome/nautilus/preferences/default-sort-in-reverse-order"
              value: "false"
              state: present
            - key: "/org/gnome/nautilus/preferences/default-folder-viewer"
              value: "'list-view'" # Possible values: icon-view, list-view
              state: present
            - key: "/org/gnome/nautilus/list-view/default-zoom-level"
              value: "'small'"
              state: present
            - key: "/org/gnome/nautilus/list-view/default-visible-columns"
              value: "['name', 'type', 'size', 'date_modified']"
              state: present
            - key: "/org/gnome/nautilus/list-view/use-tree-view"
              value: "true"
              state: present
            - key: "/org/gtk/settings/file-chooser/show-hidden"
              value: "true"
              state: present
            # -  System monitor  -
            - key: "/org/gnome/gnome-system-monitor/show-dependencies"
              value: "true"
              state: present
            - key: "/org/gnome/gnome-system-monitor/proctree/columns-order"
              value: "[0, 12, 1, 8, 15, 4, 22, 2, 3, 6, 9, 10, 11, 13, 14, 16, 17, 18, 19, 20, 21, 23, 24, 25, 26]"
              state: present
            - key: "/org/gnome/gnome-system-monitor/proctree/col-4-visible"
              value: "true"
              state: present
            # -  dconf  -
            - {
                key: "/ca/desrt/dconf-editor/show-warning",
                value: "false",
                state: present,
              }
          loop_control:
            loop_var: gnome_setting

        - name: GNOME - Set settings [BARE-METAL]
          community.general.dconf:
            key: "{{ gnome_setting.key }}"
            value: "{{ gnome_setting.value }}"
            state: "{{ gnome_setting.state }}"
          with_items:
            - key: "/org/gnome/settings-daemon/plugins/color/night-light-enabled"
              value: "true"
              state: present
            # - General Behavior -
            - key: "/org/gnome/desktop/peripherals/mouse/natural-scroll"
              value: "true"
              state: present
            - key: "/org/gnome/desktop/peripherals/touchpad/natural-scroll"
              value: "true"
              state: present
            # - Power -
            - key: "/org/gnome/desktop/session/idle-delay"
              value: "uint32 900"
              state: present
          loop_control:
            loop_var: gnome_setting
          when: "hypervisor is not defined or hypervisor | length == 0"

        - name: GNOME - Set settings [VMs]
          community.general.dconf:
            key: "{{ gnome_setting.key }}"
            value: "{{ gnome_setting.value }}"
            state: "{{ gnome_setting.state }}"
          with_items:
            # -  Power  -
            - key: "/org/gnome/settings-daemon/plugins/power/sleep-inactive-ac-type"
              value: "'nothing'"
              state: present
            - key: "/org/gnome/desktop/session/idle-delay" # Don't show black screen after idle timeout
              value: "uint32 0"
              state: present
          loop_control:
            loop_var: gnome_setting
          when: "hypervisor is defined and hypervisor | length > 0"
      become: false

    - name: Set installed apps as default
      ansible.builtin.template:
        src: linux/gnome-registered_default_apps.list.j2
        dest: "/{{ os_homedir }}/{{ user.name }}/.config/mimeapps.list"
      become: false
  when:
    - ansible_facts.os_family != 'Darwin'
    - "'GNOME' in desktop_envs"

- name: Ubuntu post packages - Disable Telemetry/error reporting + Ubuntu services
  community.general.dconf:
    key: "{{ item.key }}"
    value: "{{ item.value }}"
    state: "{{ item.state }}"
  with_items:
    - key: "/com/ubuntu/update-notifier/show-apport-crashes"
      value: "false"
      state: present
    - key: "/com/ubuntu/update-notifier/notify-ubuntu-advantage-available"
      value: "false"
      state: present
    - key: "/com/ubuntu/update-notifier/show-livepatch-status-icon"
      value: "false"
      state: present
  become: false
  when: ansible_facts.distribution == 'Ubuntu'

- name: gdm3 - Enable Autologin
  block:
    - name: Gather package facts
      ansible.builtin.package_facts:
        manager: auto

    - name: "Enable autologin for {{ user.name }}"
      block:
        - name: Set autologin config file
          ansible.builtin.set_fact:
            gdm3_config_file: "{{ 'daemon.conf' if ansible_facts.distribution == 'Debian' else 'custom.conf' }}"
          become: false

        - name: Update config file
          ansible.builtin.replace:
            path: "/etc/gdm3/{{ gdm3_config_file }}"
            # UNMATCH IF NAME is already contained: '^(#\s*|\s*)AutomaticLoginEnable\s*=\s*(true|false)\n^(#\s*|\s*)AutomaticLogin\s*=\s*(?!{{ user.name }}$)\w+$'  (doesn't work -- PROBLEM: name unmatches, which causes it not to be updated if it's commented out)
            regexp: '^#\s*AutomaticLoginEnable\s*=\s*(true|false)\n^#\s*AutomaticLogin\s*=\s*\w+$'
            replace: |
              AutomaticLoginEnable = true
              AutomaticLogin = {{ user.name }}
          become: true
  when:
    - ansible_facts.os_family != 'Darwin'
    - "'gdm3' in ansible_facts.packages"
    - "hypervisor is defined and hypervisor | length > 0" # TODO: Add also `autologin_enabled` value

- name: Perform initial-run only tasks  (which shall never be run again once completed)
  block:
    - name: Check whether tasks should be performed
      ansible.builtin.stat:
        path: "/{{ os_homedir }}/{{ user.name }}/.ansible_first_run_completed"
      register: first_run_completed

    - name: Perform ACTUAL tasks
      block:
        - name: Mute audio (requires PulseAudio)
          block:
            - name: Install PulseAudio
              ansible.builtin.apt:
                name: pulseaudio-utils
                state: present
              become: true
            - name: Mute audio
              ansible.builtin.command: pactl set-sink-mute @DEFAULT_SINK@ true
          when: "hypervisor is defined and hypervisor | length > 0"

        - name: Set GNOME settings
          community.general.dconf:
            key: "{{ gnome_setting.key }}"
            value: "{{ gnome_setting.value }}"
            state: "{{ gnome_setting.state }}"
          with_items:
            - key: "/org/gnome/shell/extensions/clipboard-history/private-mode"
              value: "true"
              state: present
          loop_control:
            loop_var: gnome_setting
          when:
            - ansible_facts.os_family != 'Darwin'
            - "'GNOME' in desktop_envs"
      when: first_run_completed.stat.exists == False

    - name: Store initial-run completed
      ansible.builtin.file:
        path: "/{{ os_homedir }}/{{ user.name }}/.ansible_first_run_completed"
        state: touch
      when: first_run_completed.stat.exists == False
  become: false
  when: ansible_facts.os_family != 'Darwin' # TODO: REVISE

# ------------------------------------------------------------------------------------------------------------------------------------------------------
# Must be enabled via: System Settings -> Privacy & Security -> Extensions -> Finder
- name: Finder services
  ansible.builtin.unarchive:
    src: "darwin/finder_workflows/{{ workflow_file }}.tar.gz"
    dest: "/Users/{{ user.name }}/Library/Services/"
    creates: "{{ workflow_file }}"
    owner: "{{ user.name }}"
    group: "{{ user.group_name }}"
    mode: 0755
  with_items:
    - "Clean LaTeX Junk.workflow"
    - "Combine PDFs.workflow"
    - "Convert PDFs to images.workflow"
    - "MP4 to MP3.workflow"
    - "Video to GIF.workflow"
  loop_control:
    loop_var: workflow_file
  become: false
  when: ansible_facts.os_family == 'Darwin'

# TODO: Merge following stuff w/ GNU/Linux based on type using `block`

- name: "[Darwin] System-wide"
  ansible.builtin.include_tasks: darwin/systemsetup.yml
  loop_control:
    loop_var: systemsetup_setting
  with_items:
    - setting: restartfreeze
      value: "Off"
    # Energy
    - setting: computersleep
      value: "{{ 1 if host_is_a_macbook else 0 }}"
    - setting: displaysleep
      value: "{{ 5 if host_is_a_macbook else 15 }}"
    - setting: harddisksleep
      value: 0
  when: ansible_facts.os_family == 'Darwin'

- name: Set wallpaper
  block:
    - name: Get current wallpaper
      ansible.builtin.shell: osascript -e 'tell app "Finder" to get posix path of (get desktop picture as alias)'
      register: result_current_wallpaper
      failed_when: false
      changed_when: false # NOTE: Doesn't work seem 2 work w/ dynamic wallpapers or Ventura live wallpapers
    - name: Set new wallpaper
      ansible.builtin.command: osascript -e 'tell app "Finder" to set desktop picture to POSIX file "{{ wallpaper }}"'
      when: result_current_wallpaper.rc != 0  or  wallpaper != result_current_wallpaper.stdout
  become: false
  when: ansible_facts.os_family == 'Darwin'

# REFERENCE: https://macos-defaults.com/
# NOTEs:
#  - `-g` in `defaults` refers 2 `NSGlobalDomain`
#  - `defaults read-type <key>` reveals type info
- name: "User-wide" # ( NOTE: Changes will take effect after logging in again )
  community.general.osx_defaults:
    domain: "{{ item.domain }}"
    key: "{{ item.key }}"
    type: "{{ item.type }}"
    value: "{{ item.value }}"
    state: present
  with_items:
    # --  UI/UX  --
    - domain: "NSGlobalDomain"
      key: "AppleInterfaceStyleSwitchesAutomatically"
      value: "true"
      type: "boolean"
    - domain: "NSGlobalDomain" # Save 2 disk (not 2 iCloud) by default
      key: "NSDocumentSaveNewDocumentsToCloud"
      value: "false"
      type: "boolean"
    - domain: "NSGlobalDomain" # Save 2 disk (not 2 iCloud) by default
      key: "NSDocumentSaveNewDocumentsToCloud"
      value: "false"
      type: "boolean"
    - domain: "NSGlobalDomain" # Expand save panel by default
      key: "NSNavPanelExpandedStateForSaveMode"
      value: "true"
      type: "boolean"
    - domain: "NSGlobalDomain" # Expand print panel by default
      key: "PMPrintingExpandedStateForPrint"
      value: "true"
      type: "boolean"
    # -  Menubar  -
    - domain: "com.apple.menuextra.clock" # Flash clock time separators; default
      key: "FlashDateSeparators"
      value: "false"
      type: "boolean"
    - domain: "com.apple.menuextra.clock"
      key: "DateFormat"
      value: "EEE d MMM HH:mm"
      type: "string"
    # -  Desktop  -
    - domain: "com.apple.finder" # Sorting: Keep folders on top when sorting
      key: "_FXSortFoldersFirstOnDesktop"
      value: "true"
      type: "boolean"
    - domain: "com.apple.finder" # Show all icons on desktop; default
      key: "CreateDesktop"
      value: "true"
      type: "boolean"
    # ( Show icons for hard drives, connected servers, and removable media on the desktop )
    - domain: "com.apple.finder" # default
      key: "ShowHardDrivesOnDesktop"
      value: "false"
      type: "boolean"
    - domain: "com.apple.finder" # default
      key: "ShowExternalHardDrivesOnDesktop"
      value: "true"
      type: "boolean"
    - domain: "com.apple.finder" # default
      key: "ShowRemovableMediaOnDesktop"
      value: "true"
      type: "boolean"
    - domain: "com.apple.finder" # default
      key: "ShowMountedServersOnDesktop"
      value: "false"
      type: "boolean"
    # --  Dock  --
    - domain: "com.apple.dock" # Make Dock icons of hidden applications translucent;  TODO: `killall Dock`
      key: "orientation"
      value: "left"
      type: "string"
    - domain: "com.apple.dock" # Set the icon size of Dock items
      key: "tilesize"
      value: "22.0"
      type: "float"
    - domain: "com.apple.dock" # Make Dock icons of hidden applications translucent;  TODO: `killall Dock`
      key: "autohide"
      value: "true"
      type: "boolean"
    - domain: "com.apple.dock" # Eliminate Dock reveal delay
      key: "autohide-time-modifier"
      value: "0"
      type: "int"
    - domain: "com.apple.dock" # Make Dock icons of hidden applications translucent;  TODO: `killall Dock`
      key: "showhidden"
      value: "true"
      type: "boolean"
    - domain: "com.apple.dock" # Make Dock icons of hidden applications translucent;  TODO: `killall Dock`; default
      key: "show-recents"
      value: "true"
      type: "boolean"
    - domain: "com.apple.dock" # Dock minimize animation (`genie`, `scale`, `suck`); default
      key: "mineffect"
      value: "genie"
      type: "string"
    - domain: "com.apple.dock" # Only show opened apps in Dock; default
      key: "static-only"
      value: "false"
      type: "boolean"
    - domain: "com.apple.dock" # Make Dock icons of hidden applications translucent;  TODO: `killall Dock`
      key: "scroll-to-open"
      value: "true"
      type: "boolean"
    # TODO: Dock items  (SEE: https://stackoverflow.com/q/67026378)
    # com.apple.dock "persistent-apps"
    #   => when `dock_fav_apps` is defined
    # --  Finder  --
    #    - domain: "com.apple.finder" # Use column view in all Finder windows by default
    #      key: "FXPreferredViewStyle"
    #      value: "clmv" # 4-letter codes for the other view modes: `icnv`, `Nlsv`, `clmv`, `Flwv`
    #      type: "string"
    - domain: "com.apple.finder" # Show hidden files by default
      key: "AppleShowAllFiles"
      value: "true"
      type: "boolean"
    - domain: "NSGlobalDomain" # Show all filename extensions
      key: "AppleShowAllExtensions"
      value: "true"
      type: "boolean"
    - domain: "com.apple.finder" # Disable the warning when changing a file extension
      key: "FXEnableExtensionChangeWarning"
      value: "false"
      type: "boolean"
    - domain: "com.apple.finder" # Set Downloads as the default location for new Finder windows
      key: "ShowPathbar"
      value: "true"
      type: "boolean"
    - domain: "com.apple.finder" # Finder: DON'T show status bar
      key: "ShowStatusBar"
      value: "false"
      type: "boolean"
    - domain: "com.apple.finder" # Display full POSIX path as Finder window title
      key: "_FXShowPosixPathInTitle"
      value: "false"
      type: "boolean"
    - domain: "com.apple.universalaccess" # Show folder icon before title in the title bar; default
      key: "showWindowTitlebarIcons"
      value: "false"
      type: "boolean"
    - domain: "NSGlobalDomain" # Toolbar title rollover delay (`0` = off)
      key: "NSToolbarTitleViewRolloverDelay"
      value: "1"
      type: "int"
    - domain: "com.apple.finder" # Sorting: Keep folders on top
      key: "_FXSortFoldersFirst"
      value: "true"
      type: "boolean"
    - domain: "NSGlobalDomain" # Sidebar icon size (`1` = small, `2` = medium, `3` = large)
      key: "NSTableViewDefaultSizeMode"
      value: "1"
      type: "int"
    - domain: "com.apple.finder" # Cmd + double-click opens new tab (`true`) or new window (`false`); default
      key: "FinderSpawnTab"
      value: "true"
      type: "boolean"
    - domain: "com.apple.finder" # Set Downloads as the default location for new Finder windows
      key: "NewWindowTarget"
      value: "PfLo"
      type: "string"
    - domain: "com.apple.finder"
      key: "NewWindowTargetPath"
      value: "file:///{{ os_homedir }}/{{ user.name }}/Downloads/"
      type: "string"
    - domain: "com.apple.finder" # Allow text selection in Quick Look
      key: "QLEnableTextSelection"
      value: "true"
      type: "boolean"
    - domain: "NSGlobalDomain" # Enable spring loading for directories
      key: "com.apple.springing.enabled"
      value: "true"
      type: "boolean"
    - domain: "NSGlobalDomain" # Remove the spring loading delay for directories
      key: "com.apple.springing.delay"
      value: "0.1"
      type: "float"
    - domain: "com.apple.finder" # Default search scope  (`SCcf` = current folder, `SCev` = this Mac)
      key: "FXDefaultSearchScope"
      value: "SCcf"
      type: "string"
    - domain: "com.apple.desktopservices" # Avoid creating .DS_Store files on network volumes
      key: "DSDontWriteNetworkStores"
      value: "true"
      type: "boolean"
    - domain: "com.apple.finder" # Empty bin items after 30 days; default
      key: "FXRemoveOldTrashItems"
      value: "false"
      type: "boolean"
    - domain: "com.apple.finder" # NOT RECOMMENDED!; default
      key: "QuitMenuItem"
      value: "false"
      type: "boolean"
    # --  Input  --
    # -  Trackpad & Mouse  -
    - domain: "NSGlobalDomain" # Enable natural scroll direction (affects trackpad AND mouse); default
      key: "com.apple.swipescrolldirection"
      value: "true"
      type: "boolean"
    - domain: "NSGlobalDomain" # Movement speed of the mouse cursor
      key: "com.apple.mouse.scaling"
      value: "3"
      type: "float"
    - domain: "NSGlobalDomain" # Disable mouse acceleration; default
      key: "com.apple.mouse.linear"
      value: "false"
      type: "boolean"
    - domain: "com.apple.AppleMultitouchTrackpad" # Click weight (threshold) (`0` = light, `1` = medium, `2` = firm); default
      key: "FirstClickThreshold"
      value: "1"
      type: "int"
    # Dragging
    - domain: "com.apple.AppleMultitouchTrackpad" # Dragging w/ drag lock (mutually exclusive w/ `Dragging` & `TrackpadThreeFingerDrag`); default
      key: "DragLock"
      value: "false"
      type: "boolean"
    - domain: "com.apple.AppleMultitouchTrackpad" # Dragging w/o drag lock (mutually exclusive w/ `DragLock` & `TrackpadThreeFingerDrag`); default
      key: "Dragging"
      value: "false"
      type: "boolean"
    - domain: "com.apple.AppleMultitouchTrackpad" # Dragging w/ 3 finger drag (mutually exclusive w/ `Dragging` & `DragLock`); default
      key: "TrackpadThreeFingerDrag"
      value: "false"
      type: "boolean"
    #
    - domain: "com.apple.Terminal" # default
      key: "FocusFollowsMouse"
      value: "false"
      type: "boolean"
    # -  Keyboard  -
    - domain: "com.apple.HIToolbox" # Fn/üåê key usage (`1` = Change input source, `2` =  Show Emoji & Symbols, `3` = Start Dictation)
      key: "AppleFnUsageType"
      value: "2"
      type: "int"
    - domain: "NSGlobalDomain" # Function keys behavior ?; default
      key: "com.apple.keyboard.fnState"
      value: "false"
      type: "boolean"
    - domain: "NSGlobalDomain" # Keyboard navigation (moving focus w/ Tab & Shift Tab; `0` = disabled, `2` = enabled)
      key: "AppleKeyboardUIMode"
      value: "2"
      type: "int"
    - domain: "kCFPreferencesAnyApplication" # Turn off the language indicator while switching input sources; default
      key: "TSMLanguageIndicatorEnabled"
      value: "true"
      type: "boolean"
    # ( Set a blazingly fast keyboard repeat rate, and make it happen more quickly   (doesn't make a difference as of now, as press-and-hold is enabled) )
    - domain: "NSGlobalDomain" # ENABLE press-and-hold (e.g., ≈Ñ popup after long pressing n, ‚Ä¶) for keys in favor of key repeat; default
      key: "ApplePressAndHoldEnabled"
      value: "true" # NOTE: MUST BE `false` 2 have blazing fast keyboard repeats
      type: "boolean"
    - domain: "NSGlobalDomain"
      key: "InitialKeyRepeat"
      value: "20"
      type: "int"
    - domain: "NSGlobalDomain"
      key: "KeyRepeat"
      value: "1"
      type: "int"
    # -  Typing  -
    - domain: "NSGlobalDomain" # Disable smart quotes
      key: "NSAutomaticQuoteSubstitutionEnabled"
      value: "false"
      type: "boolean"
    - domain: "NSGlobalDomain" # Disable smart dashes
      key: "NSAutomaticDashSubstitutionEnabled"
      value: "false"
      type: "boolean"
    - domain: "NSGlobalDomain" # Disable auto-correct
      key: "NSAutomaticSpellingCorrectionEnabled"
      value: "false"
      type: "boolean"
    # --  Mission Control  --
    - domain: "com.apple.dock" # Speed up Mission Control animations
      key: "expose-animation-duration"
      value: "0.15"
      type: "float"
    #
    # Hot corners
    #   Possible values:
    #      0: no-op
    #      2: Mission Control
    #      3: Show application windows
    #      4: Desktop
    #      5: Start screen saver
    #      6: Disable screen saver
    #      7: Dashboard
    #     10: Put display to sleep
    #     11: Launchpad
    #     12: Notification Center
    # Bottom right screen corner ‚Üí Mission Control
    - domain: "com.apple.dock"
      key: "wvous-br-corner"
      value: "0"
      type: "int"
    - domain: "com.apple.dock"
      key: "wvous-br-modifier"
      value: "0"
      type: "int"
    - domain: "com.apple.dock"
      key: "wvous-tr-corner"
      value: "0"
      type: "int"
    - domain: "com.apple.dock"
      key: "wvous-tr-modifier"
      value: "0"
      type: "int"
    - domain: "com.apple.dock"
      key: "wvous-bl-corner"
      value: "0"
      type: "int"
    - domain: "com.apple.dock"
      key: "wvous-bl-modifier"
      value: "0"
      type: "int"
    - domain: "com.apple.dock" # Rearrange Spaces automatically (`true` = based on most recent use); default
      key: "mru-spaces"
      value: "true"
      type: "boolean"
    - domain: "com.apple.dock" # Group windows by application; default
      key: "expose-group-apps"
      value: "false"
      type: "boolean"
    - domain: "NSGlobalDomain" # When switching 2 an app, switch 2 a space w/ open windows 4 this app; default
      key: "AppleSpacesSwitchOnActivate"
      value: "true"
      type: "boolean"
    - domain: "com.apple.spaces" # Displays have separate Spaces; default
      key: "spans-displays"
      value: "false"
      type: "boolean"
    # --  Screenshots  --
    - domain: "com.apple.screencapture" # Disable shadow in screenshots; default;     TODO: `killall SystemUIServer`
      key: "disable-shadow"
      value: "false"
      type: "boolean"
    - domain: "com.apple.screencapture" # Include in filename date; default;     TODO: `killall SystemUIServer`
      key: "include-date"
      value: "true"
      type: "boolean"
    #- domain: "com.apple.screencapture" # Save screenshots 2 Downloads folder
    #  key: "location"
    #  value: "/{{ os_homedir }}/{{ user.name }}/Downloads"
    #  type: "string"
    - domain: "com.apple.screencapture" # Show thumbnail; default;     TODO: `killall SystemUIServer`
      key: "show-thumbnail"
      value: "true"
      type: "boolean"
    - domain: "com.apple.screencapture" # Save screenshots in PNG format (`png`, `jpg`, `pdf`, `psd`, `gif`, `tga`, `tiff`, `bmp`, `heic`); default
      key: "type"
      value: "png"
      type: "string"
    # --  Time Machine  --
    - domain: "com.apple.TimeMachine" # Don't offer new disks 4 TM backup
      key: "DoNotOfferNewDisksForBackup"
      value: "true"
      type: "boolean"
    # --  Apps  --
    # -  Activity Monitor  -
    - domain: "com.apple.ActivityMonitor" # Show the main window when launching Activity Monitor
      key: "OpenMainWindow"
      value: "true"
      type: "boolean"
    - domain: "com.apple.ActivityMonitor" # Show all processes in Activity Monitor
      key: "ShowCategory"
      value: "0"
      type: "int"
    - domain: "com.apple.ActivityMonitor" # Update Frequency in sec (`1` = very often, `2` = often, `5` = normally)
      key: "UpdatePeriod"
      value: "2"
      type: "int"
    - domain: "com.apple.ActivityMonitor" # Update Frequency in sec (`0` = regular icon, `2` = network usage, `3` = disk usage, `5` = CPU usage)
      key: "IconType"
      value: "5"
      type: "int"
    # -  Safari & WebKit  -
    - domain: "com.apple.Safari" # Show full URL; default
      key: "ShowFullURLInSmartSearchField"
      value: "false"
      type: "boolean"
    # TODO: Don't work
    ## Enable the Develop menu and the Web Inspector in Safari
    #- domain: 'com.apple.Safari'
    #  key: 'IncludeDevelopMenu'
    #  value: 'true'
    #  type: 'boolean'
    #- domain: 'com.apple.Safari'
    #  key: 'WebKitDeveloperExtrasEnabledPreferenceKey'
    #  value: 'true'
    #  type: 'boolean'
    #- domain: 'com.apple.Safari'
    #  key: 'com.apple.Safari.ContentPageGroupIdentifier.WebKit2DeveloperExtrasEnabled'
    #  value: 'true'
    #  type: 'boolean'
    ## Add a context menu item for showing the Web Inspector in web views
    #- domain: 'NSGlobalDomain'
    #  key: 'WebKitDeveloperExtras'
    #  value: 'true'
    #  type: 'boolean'
    ## -  Mail  -
    #- domain: 'com.apple.mail'                       # Copy email addresses as `foo@example.com` instead of `Foo Bar <foo@example.com>` in Mail.app
    #  key: 'AddressesIncludeNameOnPasteboard'
    #  value: 'false'
    #  type: 'boolean'
    # -  TextEdit  -
    - domain: "com.apple.TextEdit" # Default document format
      key: "RichText"
      value: "false"
      type: "boolean"
    - domain: "com.apple.TextEdit" # Convert from neutral form 2 opening/closing variants; default
      key: "SmartQuotes"
      value: "true"
      type: "boolean"
    # - TODO:  Messages  -
    ## Disable smart quotes as it‚Äôs annoying for messages that contain code
    #defaults write com.apple.messageshelper.MessageController SOInputLineSettings -dict-add "automaticQuoteSubstitutionEnabled" -bool false
    ## Disable continuous spell checking
    #defaults write com.apple.messageshelper.MessageController SOInputLineSettings -dict-add "continuousSpellCheckingEnabled" -bool false
    # --  Misc.  --
    - domain: "NSGlobalDomain" # Close confirm changes popup
      key: "NSCloseAlwaysConfirmsChanges"
      value: "false"
      type: "boolean"
    - domain: "NSGlobalDomain" # Keep windows when quitting an application
      key: "NSQuitAlwaysKeepsWindow"
      value: "false"
      type: "boolean"
  become: false
  when: ansible_facts.os_family == 'Darwin'
