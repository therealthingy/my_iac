---
# NOTEs:
#   - !!!  IMPORTANT: On 1st launch: DON'T RUN AS ROOT  (otherwise permission errors)  !!!
#   - "UNINSTALL" (if previously used): `rm -rf  ~/.config/nvim  ~/.local/share/nvim  ~/.cache/nvim`
- name: Install it
  block:
    - name: '[Darwin / Debian/Ubuntu] Install deps'
      ansible.builtin.package:
        name: ripgrep
      become: '{{ package_manager_become }}'

    # TODO: Font in Gnome Terminal  (atm only iTerm2)
    - name: Install NerdFont
      block:
        - name: '[Debian/Ubuntu] Install deps'
          ansible.builtin.apt:
            name: fontconfig                        # Required 4 handler which rebuilds fonts cache
            state: present
          become: true
          when: ansible_facts.os_family != 'Darwin'
        - name: Set fact(s)
          ansible.builtin.set_fact:
            nf_fonts_dir: "{{ os_homedir }}/{{ user.name }}/{{ (ansible_facts['os_family'] == 'Darwin')|ternary('Library/Fonts', '.local/share/fonts') }}/"
        - name: Check already installed
          ansible.builtin.shell: "ls {{ nf_fonts_dir }}/JetBrainsMonoNerdFont*.ttf"
          failed_when: false
          changed_when: false
          register: result_nerdfont_installed
        - name: Download & install
          ansible.builtin.unarchive:
            src: "https://github.com/ryanoasis/nerd-fonts/releases/download/v{{ nerdfont_version }}/JetBrainsMono.zip"      # TODO: Always latest version
            dest: "{{ nf_fonts_dir }}"
            remote_src: true
          when: result_nerdfont_installed is failed
      notify: rebuild fonts cache

    - name: Download & Install
      ansible.builtin.git:
        repo: git@github.com:therealthingy/nvim-config.git      #https://github.com/therealthingy/nvim-config.git
        dest: '{{ os_homedir }}/{{ user.name }}/.config/nvim/'
        clone: true
        depth: 1
        update: true
      register: repo_clone
      failed_when:
        - repo_clone.failed
        - not 'Local modifications exist in the destination' in repo_clone.msg
  when: ansible_facts.os_family == 'Darwin'                  # $$$   TODO: RMV ONCE DEBIAN APT REPOS HAVE version 0.9.3 (atm 0.6 which isn't supported by nvchad)
  become: false

# TODO: `:MasonInstallAll`
