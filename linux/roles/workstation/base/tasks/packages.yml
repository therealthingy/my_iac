---
# apt -- show installed packages: `apt list --installed`
# ---------------------------------------------------------
- name: Cleanup
  block:
    - name: '[Debian/Ubuntu] Uninstall unnecessary apt packages (mostly Gnome stuff)'
      ansible.builtin.apt:
        name:
        # --  Games  --
          - aisleriot
          - gnome-mahjongg
          - gnome-mines
          - gnome-sudoku
          - gnome-2048
          - gnome-chess
          - five-or-more
          - four-in-a-row
          - hitori
          - gnome-klotski
          - lightsoff
          - gnome-nibbles
          - quadrapassel
          - gnome-robots
          - swell-foop
          - iagno
          - tali
          - gnome-taquin
          - gnome-tetravex
        # --  Apps  --
          - gnome-clocks
          - gnome-calendar
          - gnome-contacts
          - gnome-documents
          - '*gnome-todo*'
          - gnome-maps
          - gnome-music
          - '*rhythmbox*'
          - gnome-weather
          - transmission*
          - libreoffice*
          - totem                     # Media player
          - evolution                 # Mail
          - thunderbird*
          - simple-scan
          - cheese                    # NOTE: 'cheese-common', 'libcheese-gtk25' & 'libcheese8' are required by the Settings app (package 'unity-control-center')
          - 'shotwell*'
        state: absent
        purge: true
        clean: true
        autoremove: true
    - name: '[Debian/Ubuntu] (Re)Install nautilus'        # Gets rmved mysteriously â€¦
      ansible.builtin.apt:
        name: nautilus
        state: present
  become: true
  when: ansible_facts.os_family != 'Darwin' and ansible_facts.os_family == 'Debian'
# ---------------------------------------------------------


- name: Update & upgrade packages
  ansible.builtin.apt:
    update_cache: true
    cache_valid_time: 3600
    upgrade: dist
    clean: true
    autoremove: true
  become: true
  when: ansible_facts.os_family != 'Darwin'



- name: Install required ansible-related packages
  ansible.builtin.apt:
    update_cache: true
    name:
      - python3-psutil      # Required for `dconf` module
      - python3-apt         # Required by Ansible modules
      - dconf-cli
      - dconf-editor
    state: present
  become: true
  when: ansible_facts.os_family != 'Darwin'



- name: Install CLI tools
  block:
    - name: '[Debian/Ubuntu]'
      ansible.builtin.apt:
        name:
          - trash-cli
          - poppler-utils          # `pdftotext` command
          #- pdfgrep
        state: present
      become: true
      when: ansible_facts.os_family != 'Darwin'
    - name: '[Darwin]'
      community.general.homebrew:
        name:
          - ddcctl                 # DDC monitor controls for the OSX command line
          - trash
      become: false
      when: ansible_facts.os_family == 'Darwin'

- name: 'Install "Office stuff"'
  block:
    - name: '[Darwin / Debian/Ubuntu]'
      ansible.builtin.package:
        name:
          - pandoc                # Converts b/w doc formats
          - aspell
          - ispell
          - hunspell
          - ocrmypdf              # NOTE: Based on tesseract (and itsl lang packs)
    - name: Install tesseract + language packs
      block:
        - name: '[Darwin]'
          community.general.homebrew:
            name:
              - tesseract
              - tesseract-lang
          when: ansible_facts.os_family == 'Darwin'
        - name: '[Debian/Ubuntu]'
          ansible.builtin.apt:
            name:
              - tesseract-ocr
              - tesseract-ocr-deu
            state: present
          when: ansible_facts.os_family != 'Darwin' and ansible_facts.os_family == 'Debian'
  become: "{{ 'true' if ansible_facts['os_family'] != \"Darwin\" else 'false' }}"

- ansible.builtin.include_tasks: '{{ item }}'
  loop:
#    - package-kitty.yml
    - package-firefox.yml
    - package-brave.yml
    - package-codium.yml
    - package-conky.yml
    - package-flatpak.yml
  when: ansible_facts.os_family != 'Darwin'


# TODO: BAD IDEA  --> Context menu item 'Open in Terminal' will disappear
#- name: Uninstall GNOME Terminal (got replaced by Kitty)
#  ansible.builtin.apt:
#    name: gnome-terminal
#    state: absent


# TODO:  REVISE
- name: 'TODO: WORKAROUND (since no window buttons for kitty): Install termiantor'
  ansible.builtin.apt:
    name: terminator
    state: present
  become: true
  when: ansible_facts.os_family != 'Darwin'



- name: '[Ubuntu] Install packages'
  block:
    - name: Install mainline                  # Repo: https://github.com/bkw777/mainline  (tool 4 downloading & installing pre-compiled kernels)
      block:
        - name: Add apt repo
          # NOTE: Equivalent command: `sudo add-apt-repository ppa:cappelikan/ppa`
          ansible.builtin.apt_repository:
            repo: ppa:cappelikan/ppa
            state: present
            update_cache: true
        - name: Install mainline
          ansible.builtin.apt:
            name: mainline
  become: true
  when: ansible_facts.os_family != 'Darwin' and ansible_facts.distribution == 'Ubuntu'
