version: '3.7'

services:
  # >> Reference: https://hub.docker.com/r/dperson/samba <<
  {{ container_name }}:
    container_name: {{ container_name }}
    restart: "no"
    image: dperson/samba:latest
    network_mode: host
    hostname: {{ domainname }}


    # $$$  DOESN'T WORK  $$$
    #user: {{ user_uid }}:{{ docker_gid }}

    ports:
      # 'nmbd' daemon to advertise the shares
      #- 139:139
      - 445:445

    volumes:
      - "${SHARE_DIRPATH}/public:/mnt/share/public"
      - "${SHARE_DIRPATH}/private:/mnt/share/private"
      - "${TRANSMISSION_DOWNLOADS_DIRPATH}:/mnt/share/private/downloads/torrents"

    # -- Directories: -s "<name;/path>[;browse;readonly;guest;users;admins;writelist;comment]" --
    # -n -> Start the 'nmbd' daemon to advertise the shares
    # -p -> Set ownership and permissions on the shares
    command: >
      -r
      -w "{{ domainname }}"
      -u "${OWN_USER};${OWN_PW}"
      -u "${DEFAULT_USER};${DEFAULT_PW}"
      -s shared;/mnt/share/public;yes;no;no;all;none;;comment1
      -s private;/mnt/share/private;yes;no;no;gary;none;;comment1

    environment:
      - "USERID={{ user_uid }}"
      - "GROUPID={{ docker_gid }}"
      - "TZ=${TZ}"
      # Allow following symlinks
      #- "WIDELINKS=True"


    labels:
     # Traefik
      - "traefik.enable=false"
     # Watchtower
      - "com.centurylinklabs.watchtower.enable=true"
