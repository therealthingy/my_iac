---
- name: Setup containers
  ansible.builtin.include_tasks: workaround-setup.yml
  loop_control:
    loop_var: container
  with_items:
    - name: traefik
      config_files:
        - name: ssl-certgen
          mode: '0755'
        - name: dynamic-conf.yml      # $$$$$$$$  TODO: RESTART WHEN CHANGED  $$$$$$$$

    - name: baikal
      volumes:
        - 'config'
        - 'user'

    - name: bitwarden
      volumes:
        - '.'

    - name: dl_services
      volumes:
        - '.'
      startup: False

    - name: filebrowser         # TODO: COMMENT OUT
      config_files:
        - name: settings.json
      volumes:
        - '.'
      startup: False

    - name: freshrss
      volumes:
        - 'config'
      startup: False

    - name: helloworld
      startup: False

    - name: portainer         # TODO: COMMENT OUT
      volumes:
        - '.'
      startup: False

    - name: samba

    - name: syncthing
      volumes:
        - '.'
      startup: False

    - name: watchtower



- name: VPN
  block:
    - name: 'VPN: Set vars'
      ansible.builtin.set_fact:
        container:
          name: vpn
    - name: 'VPN: Run role'
      ansible.builtin.import_tasks: container-vpn.yml
